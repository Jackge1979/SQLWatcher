["type":"Oracle","data":["title":"查询RMAN的所有备份信息","sql":"SELECT A.RECID BS_KEY,

       C.RECID BP_KEY,

       CASE

         WHEN A.BACKUP_TYPE = 'L' THEN

          'Archived Redo Logs'

         WHEN A.BACKUP_TYPE = 'D' AND A.INCREMENTAL_LEVEL IS NULL THEN

          'Datafile Full Backup'

         WHEN A.BACKUP_TYPE = 'I' OR A.INCREMENTAL_LEVEL IS NOT NULL THEN

          'Incremental Backup'

       END BACKUP_TYPE,

       A.INCREMENTAL_LEVEL,

       AA.BS_BYTES,

       TO_CHAR(A.START_TIME, 'YYYY-MM-DD HH24:MI:SS') START_TIME,

       TO_CHAR(A.COMPLETION_TIME, 'YYYY-MM-DD HH24:MI:SS') END_TIME,

       A.ELAPSED_SECONDS,

       C.HANDLE PIECE_NAME,

       C.DEVICE_TYPE,

       C.TAG,

       AA.BS_STATUS,

       AA.BS_COMPRESSED,

       A.CONTROLFILE_INCLUDED,

       A.KEEP,

       A.KEEP_UNTIL,

       A.KEEP_OPTIONS,

       ------ data file -------- 

       B.FILE#,

       B.INCREMENTAL_LEVEL DF_INCREMENTAL_LEVEL,

       (SELECT NB.NAME FROM V$DATAFILE NB WHERE NB.FILE# = B.FILE#) DATAFILENAME,

       B.USED_CHANGE_TRACKING,

       B.CHECKPOINT_CHANGE# || '' DF_CHECKPOINT_CHANGE#,

       B.CHECKPOINT_TIME DF_CHECKPOINT_TIME,

       ------ archive log file --------

       D.THREAD#,

       D.SEQUENCE#,

       D.RESETLOGS_CHANGE#,

       D.FIRST_CHANGE#,

       D.FIRST_TIME,

       D.NEXT_CHANGE#,

       D.NEXT_TIME,

       ------ spfile --------

       E.MODIFICATION_TIME,

       E.DB_UNIQUE_NAME,

       ------ control file --------

       F.CREATION_TIME,

       F.CHECKPOINT_CHANGE# || '' CF_CHECKPOINT_CHANGE#,

       F.CHECKPOINT_TIME CF_CHECKPOINT_TIME,

       F.FILESIZE_DISPLAY

  FROM V$BACKUP_SET A

  LEFT OUTER JOIN V$BACKUP_FILES AA

    ON (AA.BS_KEY = A.RECID AND AA.FILE_TYPE = 'PIECE')

  LEFT OUTER JOIN V$BACKUP_DATAFILE B

    ON (A.SET_STAMP = B.SET_STAMP AND A.SET_COUNT = B.SET_COUNT)

  LEFT OUTER JOIN V$BACKUP_PIECE C

    ON (A.SET_STAMP = C.SET_STAMP AND A.SET_COUNT = C.SET_COUNT)

  LEFT OUTER JOIN V$BACKUP_ARCHIVELOG_DETAILS D

    ON (D.BTYPE_KEY = A.RECID)

  LEFT OUTER JOIN V$BACKUP_SPFILE E

    ON (A.SET_STAMP = E.SET_STAMP AND A.SET_COUNT = E.SET_COUNT)

  LEFT OUTER JOIN V$BACKUP_CONTROLFILE_DETAILS F

    ON (F.BTYPE_KEY = A.RECID)

 ORDER BY A.RECID, A.RECID, B.FILE#, D.THREAD#, D.SEQUENCE#;
"]]
